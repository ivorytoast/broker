<!doctype html>
<html lang="en">
<head>
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Broker</title>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
<div class="bg-white shadow-md rounded-lg p-6 w-full max-w-xl space-y-4">
    <h1 class="text-2xl font-bold text-gray-800">Live Stock Watchlist</h1>

    <div>
        <label class="text-gray-600 font-semibold">Watchlist:</label>
        <div id="watchlist" class="mt-2 space-y-2">
            <!-- Dynamically filled in -->
        </div>
    </div>

    <div>
        <label class="text-gray-600 font-semibold">Connections:</label>
        <div id="connections" class="mt-1 p-2 bg-gray-100 rounded text-purple-600">
            Loading...
        </div>
    </div>
</div>

<script type="module">
    import {initBrokerJavascript} from "./static/broker.js";

    const broker = initBrokerJavascript();

    const allowedSymbols = [
        "BTC-USD", "ETH-USD", "XRP-USD", "SOL-USD", "OMNI-USD",
        "CRV-USD", "USDT-USD", "SUI-USD", "GNO-USD", "LTC-USD",
        "VET-USD", "MORPHO-USD", "XCN-USD", "RSR-USD", "CVX-USD",
        "ADA-USD", "METIS-USD", "PEPE-USD", "MDT-USD"
    ];

    const watchlistDiv = document.getElementById("watchlist");

    const symbolMap = {};
    allowedSymbols.forEach(symbol => {
        const row = document.createElement("div");
        row.className = "flex justify-between bg-gray-100 p-2 rounded";

        const label = document.createElement("span");
        label.textContent = symbol;
        label.className = "font-semibold text-gray-700";

        const value = document.createElement("span");
        value.textContent = "Loading...";
        value.id = `price-${symbol}`;
        value.className = "text-blue-600";

        row.appendChild(label);
        row.appendChild(value);
        watchlistDiv.appendChild(row);

        symbolMap[symbol] = value;
    });

    broker.onMessage((topic, value) => {
        if (topic === "crypto") {
            const values = value.split(",");
            symbolMap[values[0]].textContent = `$${parseFloat(values[1]).toFixed(2)}`;
        }
    });
</script>
</body>
</html>
